// Test Observer
// -------------------------------------------------- //

// Shows all unfinished items
// -------------------------------------------------- //
App.on("get:index", function(req, res) {

    Todo.view('unfinished', function (err, tasks) {
        res.render("index", { tasks : tasks});
    });

});


// Shows all finished items
// -------------------------------------------------- //
App.on("get:done", function(req, res) {

    Todo.view('finished', function (err, tasks) {
        res.render("index", { tasks : tasks});
    });

});


// When we recieve an event from couch for a "todo" 
// type model run an event
// -------------------------------------------------- //
App.on("db:change-todo", function(change, doc) {
    doc.done && App.send("update-list", doc);
});


// When we recieve a newTodo socket event, create the new
// doc and then send it down to the client
// -------------------------------------------------- //
App.on("websocket:newTodo", function(data) {
    Todo.save({ task: data.task, done: false }, function(err, doc) {  
        Todo.send(doc.id, "newTodo");
    });
});


// On complete, we recieve a socket event
// Mark the item passed up as "done"
// -------------------------------------------------- //
App.on("websocket:complete", function(data) {
    Todo.update(data._id, { done: true });
});